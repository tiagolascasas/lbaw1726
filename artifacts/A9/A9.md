# A9: Acessos principais à base de dados e transações

## 1. Acessos principais

### M01: Autentificação e perfil individual

<table>
  <tr>
    <td><strong>SQL101</strong></td>
    <td>Criar um novo utilizador</td>
  </tr>
  <tr>
    <td><strong>Recurso Web</strong></td>
    <td>R105</td>
  </tr>
  <tr>
    <td colspan="2">
		<code style="display:block;white-space: pre-wrap">
		SELECT *
		FROM member, image, comment
		WHERE member.idImage = image.id AND member.id = $userID;

		SELECT datePosted, liked, text, idParent, idSender, idReceiver, username
		FROM comment, member
		WHERE comment.idParent = $profileID AND is_removed = false AND comment.idSender = member.id;
		</code>
	</td>
  </tr>
</table>

<table>
  <tr>
    <td><strong>SQL102</strong></td>
    <td>Obter perfil de um utilizador</td>
  </tr>
  <tr>
    <td><strong>Recurso Web</strong></td>
    <td>R106</td>
  </tr>
  <tr>
    <td colspan="2">
		<code style="display:block;white-space: pre-wrap">

		</code>
	</td>
  </tr>
</table>

### M02: Leilões

R203 api search
R205 ver um leilão
R209 licitar
R210 obter max bid


### M04: Comunicação

R402 api obter notif. não lidas
R403 marcar notif. como lida


## 2. Transações


| SQL Reference   | Transaction Name                    |
| --------------- | ----------------------------------- |
| Justification   | Justification for the transaction.  |
| Isolation level | Isolation level of the transaction. |
| `Complete SQL Code`                                   |

member + image
auction + image
auctionmod + image
accountTermination + member

```sql
BEGIN TRANSACTION;
SET TRANSACTION ISOLATION LEVEL READ COMMITTED
 
-- Insert users
 INSERT INTO users (address, age, email, name, password, phone, postalCode, username, idCountry) VALUES ($address, $age, $email, $name, $password, $phone, $postalCode, $username, $idCountry);
 
-- Insert image 
  INSERT INTO image (source, idusers) VALUES ($source, $idusers);
 
COMMIT;
```

```sql
BEGIN TRANSACTION;
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED 
 
-- Insert auction
  UPDATE users SET users_status = terminated WHERE id = $userID;
 
-- Insert image 
  DELETE FROM requested_termination WHERE idusers = $idRequest;
 
COMMIT;
```


```sql
BEGIN TRANSACTION;
SET TRANSACTION ISOLATION LEVEL REPEATABLE READ 
 
-- Insert auction
 INSERT INTO auction (author, description, duration, ISBN, title, idPublisher, idLanguage, idSeller) VALUES ($author, $description, $duration, $ISBN, $title, $idPublisher, $idLanguage, $userID);
 
-- Insert image 
 INSERT INTO image (source, idAuction) VALUES ($source, $idAuction);
 
COMMIT;
```

```sql
BEGIN TRANSACTION;
SET TRANSACTION ISOLATION LEVEL REPEATABLE READ 
 
-- Insert auction
  INSERT INTO auction_modification (newDescription, idApprovedAuction) VALUES ($newDescription, $idApprovedAuction);
 
-- Insert image 
  INSERT INTO image (source, idAuctionModification) VALUES ($source, $idAuctionModification);
 
COMMIT;
```

***
GROUP1726, 18/4/2018

> Daniel Vieira Azevedo, up201000307@fe.up.pt

> Nelson André Garrido da Costa, up201403128@fe.up.pt

> Rúben José da Silva Torres, up201405612@fe.up.pt

> Tiago Lascasas dos Santos, up201503616@fe.up.pt
